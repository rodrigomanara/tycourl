<!-- Recent Links List -->
<div class="hidden bg-white rounded-xl shadow-lg overflow-hidden" id="recent-links">
    <div class="p-6 border-b border-gray-200">
        <div class="flex justify-between items-center">
            <h3 class="text-xl font-bold text-gray-900">Recent Links</h3>
            <input type="text" placeholder="Search links..."
                   class="text-sm border border-gray-300 rounded-lg px-4 py-2 outline-none focus:ring-2 focus:ring-blue-500">
        </div>
    </div>

    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Short Link
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Original URL
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Clicks
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Created
                </th>

            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="list-table-recents"></tbody>
        </table>
    </div>

    <div class="px-6 py-4 border-t border-gray-200 flex justify-between items-center">
        <p class="text-sm text-gray-600">Total 10 ... links</p>
    </div>
</div>

<script>
    (function () {
        let user = null;
        var loop = setInterval(function () {
            if (User !== undefined) {
                user = new User();
                init();
                document.getElementById('recent-links').classList.remove('hidden');
                clearInterval(loop);
            }
        }, 500)

        function init() {
            let user_id = user.getId();
            let token = user.getToken();
            mostRecents(user_id, token);
        }


        function mostRecents(user_id, token) {

            fetch(`/rest/api/dashboard/retrieve/most-recent-links`, {
                headers: {
                    'content-type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }, method: 'POST',
                body: JSON.stringify({
                    user_id: user_id
                })
            }).then(response => response.json()).then(data => {
                if (data.response.success) {
                    buildList(data.response.data);
                }
            }).catch(error => {
                //logout();
            });

        }

        /**
         *
         * @param a
         * @param b
         * @returns {string}
         */
        function calculateClick(a, b) {
            let total = ((a / b) * 100);
            return `${isNaN(total) ? 0 : total}%`;
        }

        /**
         *
         * @param url
         * @returns {string}
         */
        function link(url) {
            let fullUrl = `${window.location.origin}/${url}`;
            return `<a href="${fullUrl}" target="_blank">${fullUrl}</a>`;

        }


        function buildList(data) {
            let table = document.getElementById('list-table-recents');


            data.forEach(element => {
                table.innerHTML += `
              <tr class="hover:bg-gray-50 transition">
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-500 rounded flex items-center justify-center text-white text-xs font-bold mr-3">
                            SL
                        </div>
                        <span class="text-sm font-medium text-blue-600">${link(element.hash)}</span>
                    </div>
                </td>
                <td class="px-6 py-4">
                    <span class="text-sm text-gray-900 truncate max-w-xs block">
                        ${element.url}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <span class="text-sm font-semibold text-gray-900">${element.clicks ?? 0}</span>
                        <span class="ml-2 text-xs text-green-600">${calculateClick(element.clicksToday, element.clicks)}</span>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${element.date_create}</td>
            </tr>
              `
            });
        }
    })();
</script>